extends layout

block customStyle
  link(rel="stylesheet", href="/vendor/ol/ol.css")
  link(rel="stylesheet", href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css")

block content
  //- pre #{h.dump(orga)}
  .pure-g
    unless orga
      .banner
        h1.banner__head= title
    .pure-u-1.content
      if orga
        .pure-u-1.photo-orga-event
          //- Logo
          img(src=(orga.photo ? `/uploads/${orga.photo}` : "/images/default.jpg") alt="Logo de l'organisme")
        .separator.top-space
      form.pure-u-1(action=`/organisms/add${orga?`/${orga._id}`:""}?_csrf=${csrfToken}` method="POST" enctype="multipart/form-data")
        - const savedData = h.store.get("editorgas-form-data")
        - const errorData = h.store.get("form-errors")
        - h.store.remove("form-errors")
        .pure-u-1
          if orga
            //- Edit & Archive buttons
            .pure-u-1.text-center.top-space-40
              a(href=`/organism/${orga.slug}?remove=true` title="Archiver")
                span.icon!= h.icon("archive")
          //- Name
          .pure-u-1.top-space-40
            span.pure-u-2-24.icon!= h.icon("clipboard-pencil")
            input.pure-u-22-24( autocomplete="off" type="text" placeholder="Nom de votre groupe" name="name" value=`${savedData?savedData.name:(orga ? orga.name : "")}` class=`${errorData && errorData.includes("name")?"error":""}` required)
          //- Logo input
          .pure-u-1.top-space-40.text-center
            label.pure-button.pure-button-primary(for="fileUpload") Logo du groupe
            input.show-for-sr#fileUpload(type="file" name="photo" accept="image/gif, image/png, image/jpeg")
            .file-upload-filename
          //-.pure-u-1.top-space-40
            .pure-u-1.u-md-1-4
              label.pure-radio(for="association")
                input#association(type="radio" name="type" value="Association" checked="checked")
                | Association
            .pure-u-1.u-md-1-4
              label.pure-radio(for="entreprise")
                input#entreprise(type="radio" name="type" value="Entreprise")
                | Entreprise
            .pure-u-1.u-md-1-4
              label.pure-radio(for="ong")
                input#ong(type="radio" name="type" value="ONG")
                | ONG
            .pure-u-1.u-md-1-4
              label.pure-radio(for="collectivite")
                input#collectivite(type="radio" name="type" value="Collectivité")
                | Collectivité
          //- Description
          .pure-u-1.top-space-40
            label Description du groupe et de vos actions :
          .pure-u-1.top-space
            textarea#md( autocomplete="off" name="description" value=`${savedData?savedData.description:(orga ? orga.description : "")}` placeholder="Donnez envie !") #{savedData?savedData.description:(orga ? orga.description : "")}
          //-.pure-u-1.top-space
            label Où se situe votre siège social ?
            #map.no-events
          //-.pure-u-1
            span.input-group-label: i.fi-marker.size-36
            input.input-group-field#address(type="text" placeholder="Adresse" name="location[address]" value=(orga &&orga.location && orga.location.address))
            input#longitude(type="hidden" name="location[coordinates][0]" value=(orga && orga.location && orga.location.coordinates[0]))
            input#latitude(type="hidden" name="location[coordinates][1]" value=(orga && orga.location && orga.location.coordinates[1]))
          .pure-u-1.top-space-40
            input.pure-button.success.button.expanded(type="submit" value=`${orga ? "Valider" : "Créer"}`)

block customScripts
  script(src="/vendor/ol/ol.min.js")
